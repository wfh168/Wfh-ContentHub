# 文件上传接口测试示例

## 支持的文件格式

文件上传接口支持**任意文件格式**，包括但不限于：

- **文档类**：`.md`, `.txt`, `.doc`, `.docx`, `.pdf`, `.xls`, `.xlsx`, `.ppt`, `.pptx`, `.csv`, `.rtf` 等
- **图片类**：`.jpg`, `.jpeg`, `.png`, `.gif`, `.bmp`, `.webp`, `.svg`, `.ico` 等
- **视频类**：`.mp4`, `.avi`, `.mov`, `.wmv`, `.flv`, `.mkv`, `.webm` 等
- **音频类**：`.mp3`, `.wav`, `.flac`, `.aac`, `.ogg`, `.wma` 等
- **其他格式**：支持任意文件格式上传

**文件限制：**
- 文件大小：最大100MB
- 文件会自动根据扩展名和目录进行分类（AVATAR、IMAGE、VIDEO、AUDIO、DOCUMENT、OTHER）

## 问题说明

如果遇到错误：`Required request part 'file' is not present`，说明 curl 命令没有正确发送文件数据。

## 正确的 curl 命令

### 1. 上传文件到指定目录

```bash
# 上传 Markdown 文件（.md）
curl -X 'POST' \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'accept: */*' \
  -H 'Authorization: b518f232-14e0-4a67-b4c8-b2e4d76605dd' \
  -F 'file=@/path/to/your/file.md'

# 上传其他格式文件（支持任意格式）
curl -X 'POST' \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'accept: */*' \
  -H 'Authorization: b518f232-14e0-4a67-b4c8-b2e4d76605dd' \
  -F 'file=@/path/to/your/file.txt'
```

### 2. 上传头像

```bash
curl -X 'POST' \
  'http://localhost:8006/file/avatar/upload' \
  -H 'accept: */*' \
  -H 'Authorization: b518f232-14e0-4a67-b4c8-b2e4d76605dd' \
  -F 'file=@/path/to/your/avatar.jpg'
```

## 关键点说明

1. **使用 `-F` 参数**：`-F` (或 `--form`) 会自动设置 `Content-Type: multipart/form-data` 并添加正确的 boundary
2. **文件参数格式**：`file=@文件路径`，其中：
   - `file` 是接口中定义的参数名（与 `@RequestPart("file")` 对应）
   - `@` 符号表示后面的路径是文件路径
3. **不要手动设置 Content-Type**：使用 `-F` 时，curl 会自动设置正确的 Content-Type 和 boundary

## 常见错误示例

### ❌ 错误示例1：手动设置 Content-Type（缺少文件数据）

```bash
curl -X 'POST' \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'Content-Type: multipart/form-data' \
  -H 'Authorization: ...'
```

**问题**：只设置了 Content-Type，但没有发送实际的文件数据。

### ❌ 错误示例2：使用 `-d` 参数（用于 JSON，不适用于文件）

```bash
curl -X 'POST' \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'Content-Type: multipart/form-data' \
  -d 'file=test.txt'
```

**问题**：`-d` 用于发送表单数据或 JSON，不适合发送文件。

## 其他测试工具

### Postman
1. 选择 `POST` 方法
2. 在 Body 标签页选择 `form-data`
3. 添加 key `file`，类型选择 `File`
4. 点击 Select Files 选择文件
5. 在 Headers 中添加 `Authorization: {token}`

### Swagger UI
1. 访问 `http://localhost:8006/swagger-ui.html`
2. 找到文件上传接口
3. 点击 "Try it out"
4. 在文件输入框选择文件
5. 点击 "Execute"

## Windows PowerShell 示例

```powershell
# PowerShell 中使用 curl（实际上是 Invoke-WebRequest 的别名）
# 需要使用完整的 curl.exe 或使用 Invoke-RestMethod

$uri = "http://localhost:8006/file/upload?directory=documents"
$headers = @{
    "accept" = "*/*"
    "Authorization" = "b518f232-14e0-4a67-b4c8-b2e4d76605dd"
}
$formData = @{
    file = Get-Item "C:\path\to\your\file.txt"
}

Invoke-RestMethod -Uri $uri -Method Post -Headers $headers -Form $formData
```

## Linux/Mac 示例

```bash
# 上传 Markdown 文件
curl -X POST \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'Authorization: b518f232-14e0-4a67-b4c8-b2e4d76605dd' \
  -F 'file=@/path/to/readme.md'

# 上传文本文件
curl -X POST \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'Authorization: b518f232-14e0-4a67-b4c8-b2e4d76605dd' \
  -F 'file=@/path/to/document.txt'

# 上传 PDF 文件
curl -X POST \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'Authorization: b518f232-14e0-4a67-b4c8-b2e4d76605dd' \
  -F 'file=@/path/to/document.pdf'

# 带详细输出的版本（用于调试）
curl -v -X POST \
  'http://localhost:8006/file/upload?directory=documents' \
  -H 'Authorization: b518f232-14e0-4a67-b4c8-b2e4d76605dd' \
  -F 'file=@/path/to/file.md'
```

## 验证响应

成功响应示例：
```json
{
  "code": 200,
  "message": "文件上传成功",
  "data": "http://192.168.200.130:9000/public-bucket/documents/2024-10-31/xxx.txt"
}
```

失败响应示例：
```json
{
  "timestamp": "2025-10-31T04:58:46.117+00:00",
  "status": 400,
  "error": "Bad Request",
  "path": "/file/upload"
}
```

