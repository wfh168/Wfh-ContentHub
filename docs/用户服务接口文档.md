# 用户服务接口文档

## 一、认证相关接口

### 1. 用户注册

**接口地址**: `POST /user/register`

**请求参数**:
```json
{
  "username": "testuser",      // 必填，3-20字符
  "nickname": "测试用户",       // 必填，最多50字符
  "email": "test@example.com", // 可选，需符合邮箱格式
  "phone": "13800138000",      // 可选
  "password": "123456"         // 必填，6-20字符
}
```

**成功响应**:
```json
{
  "code": 200,
  "message": "注册成功",
  "data": null,
  "timestamp": 1234567890
}
```

**异常情况**:
- 用户名已存在: `{"code": 500, "message": "用户名已存在"}`
- 邮箱已被注册: `{"code": 500, "message": "邮箱已被注册"}`
- 手机号已被注册: `{"code": 500, "message": "手机号已被注册"}`
- 参数校验失败: `{"code": 400, "message": "用户名长度必须在3-20之间"}`

---

### 2. 用户登录

**接口地址**: `POST /user/login`

**请求参数**:
```json
{
  "username": "testuser",  // 支持用户名/邮箱/手机号
  "password": "123456"
}
```

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": 1,
    "username": "testuser",
    "nickname": "测试用户",
    "avatarUrl": "http://example.com/avatar.jpg",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "timestamp": 1234567890
}
```

**异常情况**:
- 用户不存在: `{"code": 500, "message": "用户不存在"}`
- 密码错误: `{"code": 500, "message": "密码错误"}`
- 账号被禁用: `{"code": 500, "message": "账号已被禁用"}`

---

### 3. 退出登录

**接口地址**: `POST /user/logout`

**请求头**:
```
Authorization: Bearer {token}
```

**成功响应**:
```json
{
  "code": 200,
  "message": "退出成功",
  "data": null,
  "timestamp": 1234567890
}
```

---

### 4. 刷新Token

**接口地址**: `POST /user/refresh`

**请求头**:
```
Authorization: Bearer {token}
```

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "userId": 1,
    "username": "testuser",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "timestamp": 1234567890
}
```

---

### 5. 获取当前用户信息

**接口地址**: `GET /user/current`

**请求头**:
```
Authorization: Bearer {token}
```

**成功响应**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "username": "testuser",
    "nickname": "测试用户",
    "email": "test@example.com",
    "phone": "13800138000",
    "avatarUrl": "http://example.com/avatar.jpg",
    "bio": "这是个人简介",
    "gender": 1,
    "birthday": "1990-01-01",
    "location": "北京",
    "level": 1,
    "experience": 0,
    "role": "user",
    "createdAt": "2024-01-01 12:00:00"
  },
  "timestamp": 1234567890
}
```

---

## 二、用户管理接口

### 6. 根据ID获取用户信息

**接口地址**: `GET /user/{userId}`

**路径参数**:
- `userId`: 用户ID

**成功响应**: 同"获取当前用户信息"

---

### 7. 更新用户信息

**接口地址**: `PUT /user/{userId}`

**请求头**:
```
Authorization: Bearer {token}
```

**请求参数**:
```json
{
  "nickname": "新昵称",
  "bio": "新的个人简介",
  "gender": 1,
  "birthday": "1990-01-01",
  "location": "北京"
}
```

**成功响应**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null,
  "timestamp": 1234567890
}
```

---

## 三、数据字典

### 用户状态（status）
- `0`: 禁用
- `1`: 正常

### 用户角色（role）
- `user`: 普通用户
- `admin`: 管理员

### 性别（gender）
- `0`: 未知
- `1`: 男
- `2`: 女

### 认证类型（identityType）
- `phone`: 手机号
- `email`: 邮箱
- `wechat`: 微信
- `qq`: QQ
- `github`: GitHub

---

## 四、错误码说明

| 错误码 | 说明 |
|-------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未登录或Token已过期 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

---

## 五、使用示例

### Postman测试

1. **注册用户**
```
POST http://localhost:8001/user/register
Content-Type: application/json

{
  "username": "testuser",
  "nickname": "测试用户",
  "email": "test@example.com",
  "password": "123456"
}
```

2. **登录获取Token**
```
POST http://localhost:8001/user/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "123456"
}
```

3. **使用Token访问受保护接口**
```
GET http://localhost:8001/user/current
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### JavaScript示例

```javascript
// 注册
axios.post('/api/user/register', {
  username: 'testuser',
  nickname: '测试用户',
  email: 'test@example.com',
  password: '123456'
});

// 登录
const loginRes = await axios.post('/api/user/login', {
  username: 'testuser',
  password: '123456'
});
const token = loginRes.data.data.token;

// 携带Token请求
axios.get('/api/user/current', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

---

## 六、注意事项

1. **密码安全**
   - 密码使用BCrypt加密存储
   - 前端传输使用HTTPS
   - 密码长度6-20字符

2. **Token管理**
   - Token有效期为7天
   - Token失效后需要重新登录或刷新Token
   - 建议使用localStorage或sessionStorage存储Token

3. **登录支持**
   - 支持用户名登录
   - 支持邮箱登录
   - 支持手机号登录

4. **数据验证**
   - 所有必填字段不能为空
   - 邮箱格式需符合规范
   - 用户名3-20字符，昵称最多50字符

